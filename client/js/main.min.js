"use strict";$(document).ready((function(){rin.init()}));let rin={slickUI:null,async init(){},async initGame(){await this.preload.start(),$("._no-game").each((function(e){$(this).addClass("hide")})),$(".game-wr").removeClass("hide"),await this.impInit(),await this.game.init(),this.winManager.init()},async impInit(){return this.winManager=await import("./modules/winManager.js"),this.winManager=this.winManager.winManager,this.PlayerClass=await import("./entities/player.js"),this.PlayerClass=this.PlayerClass.Player,this.EnemyClass=await import("./entities/enemy.js"),this.EnemyClass=this.EnemyClass.Enemy,this.BonusClass=await import("./entities/bonus.js"),this.BonusClass=this.BonusClass.Bonus,this.LineDrawer=await import("./entities/linedrawer.js"),this.LineDrawer=this.LineDrawer.LineDrawer,Promise.resolve()},preload:{start:()=>(loading_screen=pleaseWait({logo:"/assets/logo.jpg",backgroundColor:"#383838",loadingHtml:"<div class='spinner'><div class='bounce1'></div><div class='bounce2'></div><div class='bounce3'></div></div>"}),Promise.resolve()),stop(){window.loading_screen.finish()}},inputHandler:{inputs:{up:!1,down:!1,right:!1,left:!1},sendCooldown:1,init(){document.onkeydown=e=>{68===e.keyCode?this.inputs.right=!0:83===e.keyCode?this.inputs.down=!0:65===e.keyCode?this.inputs.left=!0:87===e.keyCode&&(this.inputs.up=!0),rin.socket.updateServer()},document.onkeyup=e=>{68===e.keyCode?this.inputs.right=!1:83===e.keyCode?this.inputs.down=!1:65===e.keyCode?this.inputs.left=!1:87===e.keyCode&&(this.inputs.up=!1),rin.socket.updateServer()},window.onblur=()=>{this.inputs.right=this.inputs.down=this.inputs.left=this.inputs.up=!1,rin.socket.updateServer()}},updateMouseDown(){rin.game.ins.input.activePointer.leftButton.isDown&&(this.sendCooldown--,this.sendCooldown||(this.sendCooldown=10,rin.GunHandler.useRequest()))}},game:{ins:null,map:null,layer:null,start:!1,currentPlayer:null,init(){return this.ins=new Phaser.Game("100%","100%",Phaser.AUTO,"game",{preload:this.preload,create:this.create,update:this.update}),Promise.resolve()},preload(){this.load.image("player","/assets/player.png"),this.load.image("enemy","/assets/enemy-common-1.png"),this.load.image("rifleammo","/assets/rifleammo.png"),this.load.image("shotgunammo","/assets/shotgunammo.png"),this.load.image("sniperammo","/assets/sniperammo.png"),this.load.image("cure","/assets/cure.png"),this.load.tilemap("map","/assets/map/map.csv"),this.load.image("tiles","/assets/map/map-tileset.png"),rin.slickUI=rin.game.ins.plugins.add(Phaser.Plugin.SlickUI),rin.slickUI.load("/assets/UI/kenney.json")},create(){this.game.world.setBounds(200,20,1440,900),this.game.map=this.add.tilemap("map",64,64),this.game.map.addTilesetImage("tiles"),this.game.layer=this.game.map.createLayer(0),this.game.layer.resizeWorld(),this.game.layer.position.set(1,1),this.game.time.advancedTiming=!0,this.game.stage.disableVisibilityChange=!0,this.game.stage.backgroundColor="#95BCC7",this.game.scale.scaleMode=Phaser.ScaleManager.NO_SCALE,this.game.physics.startSystem(Phaser.Physics.P2JS),this.game.input.mouse.capture=!0,rin.PlayerClass.group=this.game.add.group(),rin.EnemyClass.group=this.game.add.group(),rin.BonusClass.group=this.game.add.group(),rin.LineDrawer.group=this.game.add.group(),rin.winManager.createUI(),rin.socket.init()},initCurrentPlayer(e){this.currentPlayer=new rin.PlayerClass(e,!0)},currentPlayerUpdate(e){let i=this.ins.camera.x+this.ins.input.mousePointer.x,s=this.ins.camera.y+this.ins.input.mousePointer.y,n=Math.abs(180*Math.atan((s-this.currentPlayer.gameObj.y)/(i-this.currentPlayer.gameObj.x))/Math.PI);i>this.currentPlayer.gameObj.x&&s>this.currentPlayer.gameObj.y?this.currentPlayer.gameObj.angle=n:i<this.currentPlayer.gameObj.x&&s>this.currentPlayer.gameObj.y?this.currentPlayer.gameObj.angle=-180-n:i<this.currentPlayer.gameObj.x&&s<this.currentPlayer.gameObj.y?this.currentPlayer.gameObj.angle=-180+n:this.currentPlayer.gameObj.angle=-n,this.currentPlayer.gameObj.x=this.currentPlayer.x=e.position[0],this.currentPlayer.gameObj.y=this.currentPlayer.y=e.position[1]},update(){rin.inputHandler.updateMouseDown(),rin.LineDrawer.updateAll(),rin.winManager.update(),rin.PlayerClass.updateAllPositions(),rin.EnemyClass.updateAllPositions()}},socket:{ins:null,init(){this.ins=io(),this.ins.on("connect",()=>{rin.game.initCurrentPlayer(this.ins.id),this.ins.on("newPlayer",rin.PlayerClass.addNewPlayer),this.ins.on("playerDisconnect",rin.PlayerClass.removePlayer),this.ins.on("onInitialJoinPopulatePlayers",rin.PlayerClass.onInitialJoinPopulatePlayers),this.ins.on("onInitialJoinPopulateEnemies",rin.EnemyClass.onInitialJoinPopulateEnemies),this.ins.on("onInitialJoinPopulateBonus",rin.BonusClass.onInitialJoinPopulateBonus),this.ins.on("updateClientOnPlayers",rin.PlayerClass.updateAll),this.ins.on("updateClientOnEnemies",rin.EnemyClass.updateAll),this.ins.on("createEnemy",rin.EnemyClass.createEnemy),this.ins.on("removeEnemy",rin.EnemyClass.removeEnemy),this.ins.on("createGunShot",rin.GunHandler.createGunShot),this.ins.on("createBonus",rin.BonusClass.createBonus),this.ins.on("destroyBonus",rin.BonusClass.destroyBonus),rin.game.ins.camera.follow(rin.game.currentPlayer.gameObj,Phaser.Camera.FOLLOW_TOPDOWN,.1,.1),rin.game.ins.time.events.loop(100,rin.socket.updateServer,this),rin.game.start=!0,rin.inputHandler.init()}),rin.preload.stop()},updateServer(){this.ins.emit("updateServer",{inputs:rin.inputHandler.inputs,angle:rin.game.currentPlayer.gameObj.angle})}},GunHandler:{createGunShot(e){let i=e.startx+e.length*Math.cos(e.angle/180*Math.PI),s=e.starty+e.length*Math.sin(e.angle/180*Math.PI),n=(new rin.LineDrawer).graphics;n.moveTo(e.startx,e.starty),n.lineTo(i,s)},useRequest(){let e=rin.game.ins.input.mousePointer.x+rin.game.ins.camera.x,i=rin.game.ins.input.mousePointer.y+rin.game.ins.camera.y;rin.socket.ins.emit("useRequest",[e,i])}}};