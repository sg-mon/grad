"use strict";$(document).ready((function(){rin.init()}));let rin={slickUI:null,$socket:null,layer:null,async init(){this.$socket=io(),await this.impInit()},async initGame(){return await this.preload.start(),$("._no-game").each((function(e){$(this).addClass("hide")})),$(".game-wr").removeClass("hide"),await this.game.init(),this.winManager.init(),Promise.resolve()},async impInit(){return this.winManager=await import("./modules/winManager.js"),this.winManager=this.winManager.winManager,this.PlayerClass=await import("./entities/player.js"),this.PlayerClass=this.PlayerClass.Player,this.EnemyClass=await import("./entities/enemy.js"),this.EnemyClass=this.EnemyClass.Enemy,this.BonusClass=await import("./entities/bonus.js"),this.BonusClass=this.BonusClass.Bonus,this.LineDrawer=await import("./entities/linedrawer.js"),this.LineDrawer=this.LineDrawer.LineDrawer,Promise.resolve()},connect(e){this.$socket=io("/"+e),this.$socket.on("roomsList",rin.rooms.show),this.$socket.on("newRoom",rin.rooms.showNewRoom),this.$socket.on("updateRoom",rin.rooms.updateRoom),this.$socket.on("removeRoom",rin.rooms.removeRoom),rin.socket.init()},rooms:{all:{},show(e){Object.keys(e).length&&rin.rooms.showAll(e),$(".rooms").removeClass("hide"),$(".play").addClass("hide")},showAll(e){$(".room-items-empty").addClass("hide");for(let t in e)rin.rooms.showNewRoom(e[t])},showNewRoom(e){if($(".room-items-empty").hasClass("hide")||$(".room-items-empty").addClass("hide"),e.id in rin.rooms.all)return;let t=$("._test-room-item").clone();$(t).attr("data-id",e.id),$(t).removeClass("_test-room-item"),$(t).find("._room-id").text(e.id),$(t).find("._room-title").text(e.title),$(t).find("._room-players").text(`${e.playerCount}/${e.maxPlayerCount}`),$("._room-items-all").append(t),rin.rooms.all[e.id]=e},updateRoom(e){let t=$(`.room-item[data-id=${e.id}]`);$(t).find("._room-id").text(e.id),$(t).find("._room-title").text(e.title),$(t).find("._room-players").text(`${e.playerCount}/${e.maxPlayerCount}`),rin.rooms.all[e.id]=e},removeRoom(e){delete rin.rooms.all[e],$(`.room-item[data-id=${e}]`).remove(),Object.keys(rin.rooms.all)||$(".room-items-empty").removeClass("hide")},async join(e){rin.rooms.currentId=$(e.target).closest(".room-item").data("id"),await rin.initGame()},createReq(e){e.preventDefault(),$(e.target).removeClass("error");let t={};for(let i of $(e.target).serializeArray())t[i.name]=i.value;for(let i in t)if(!t[i])return void $(e.target).addClass("error");rin.$socket.emit("createRoom",t),rin.popups.close(".room-create")}},preload:{start:()=>(window.loading_screen=pleaseWait({logo:"/assets/logo.jpg",backgroundColor:"#383838",loadingHtml:"<div class='spinner'><div class='bounce1'></div><div class='bounce2'></div><div class='bounce3'></div></div>"}),Promise.resolve()),stop(){window.loading_screen.finish()}},inputHandler:{inputs:{up:!1,down:!1,right:!1,left:!1},sendCooldown:1,init(){document.onkeydown=e=>{68===e.keyCode?this.inputs.right=!0:83===e.keyCode?this.inputs.down=!0:65===e.keyCode?this.inputs.left=!0:87===e.keyCode&&(this.inputs.up=!0),rin.socket.updateServer()},document.onkeyup=e=>{68===e.keyCode?this.inputs.right=!1:83===e.keyCode?this.inputs.down=!1:65===e.keyCode?this.inputs.left=!1:87===e.keyCode&&(this.inputs.up=!1),rin.socket.updateServer()},window.onblur=()=>{this.inputs.right=this.inputs.down=this.inputs.left=this.inputs.up=!1,rin.socket.updateServer()}},updateMouseDown(){rin.game.ins.input.activePointer.leftButton.isDown&&(this.sendCooldown--,this.sendCooldown||(this.sendCooldown=10,rin.GunHandler.useRequest()))}},game:{ins:null,map:null,layer:null,start:!1,currentPlayer:null,init(){return this.ins=new Phaser.Game("100%","100%",Phaser.AUTO,"game",{preload:this.preload,create:this.create,update:this.update}),Promise.resolve()},preload(){this.load.image("player","/assets/player.png"),this.load.image("enemy","/assets/enemy-common-1.png"),this.load.image("rifleammo","/assets/rifleammo.png"),this.load.image("shotgunammo","/assets/shotgunammo.png"),this.load.image("sniperammo","/assets/sniperammo.png"),this.load.image("cure","/assets/cure.png"),this.load.tilemap("map","/assets/map/map.csv"),this.load.image("tiles","/assets/map/map-tileset.png"),rin.slickUI=rin.game.ins.plugins.add(Phaser.Plugin.SlickUI),rin.slickUI.load("/assets/UI/kenney.json")},create(){this.game.world.setBounds(200,20,1440,900),this.game.map=this.add.tilemap("map",64,64),this.game.map.addTilesetImage("tiles"),rin.layer=this.game.map.createLayer(0),rin.layer.resizeWorld(),rin.layer.position.set(1,1),this.game.time.advancedTiming=!0,this.game.stage.disableVisibilityChange=!0,this.game.stage.backgroundColor="#95BCC7",this.game.scale.scaleMode=Phaser.ScaleManager.NO_SCALE,this.game.physics.startSystem(Phaser.Physics.P2JS),this.game.input.mouse.capture=!0,rin.PlayerClass.group=this.game.add.group(),rin.EnemyClass.group=this.game.add.group(),rin.BonusClass.group=this.game.add.group(),rin.LineDrawer.group=this.game.add.group(),rin.game.initCurrentPlayer(rin.$socket.id),rin.game.ins.camera.follow(rin.game.currentPlayer.gameObj,Phaser.Camera.FOLLOW_TOPDOWN,.1,.1),rin.game.ins.time.events.loop(100,rin.socket.updateServer,this),rin.game.start=!0,rin.$socket.emit("joinRoom",rin.rooms.currentId),rin.winManager.createUI(),rin.preload.stop()},initCurrentPlayer(e){this.currentPlayer=new rin.PlayerClass(e,!0)},currentPlayerUpdate(e){let t=this.ins.camera.x+this.ins.input.mousePointer.x,i=this.ins.camera.y+this.ins.input.mousePointer.y,s=Math.abs(180*Math.atan((i-this.currentPlayer.gameObj.y)/(t-this.currentPlayer.gameObj.x))/Math.PI);t>this.currentPlayer.gameObj.x&&i>this.currentPlayer.gameObj.y?this.currentPlayer.gameObj.angle=s:t<this.currentPlayer.gameObj.x&&i>this.currentPlayer.gameObj.y?this.currentPlayer.gameObj.angle=-180-s:t<this.currentPlayer.gameObj.x&&i<this.currentPlayer.gameObj.y?this.currentPlayer.gameObj.angle=-180+s:this.currentPlayer.gameObj.angle=-s,this.currentPlayer.gameObj.x=this.currentPlayer.x=e.position[0],this.currentPlayer.gameObj.y=this.currentPlayer.y=e.position[1]},update(){rin.inputHandler.updateMouseDown(),rin.LineDrawer.updateAll(),rin.winManager.update(),rin.PlayerClass.updateAllPositions(),rin.EnemyClass.updateAllPositions()}},socket:{ins:null,init(){rin.$socket.on("connectToRoom",()=>{rin.$socket.on("newPlayer",rin.PlayerClass.addNewPlayer),rin.$socket.on("playerDisconnect",rin.PlayerClass.removePlayer),rin.$socket.on("onInitialJoinPopulatePlayers",rin.PlayerClass.onInitialJoinPopulatePlayers),rin.$socket.on("updateClientOnPlayers",rin.PlayerClass.updateAll),rin.$socket.on("createGunShot",rin.GunHandler.createGunShot),rin.inputHandler.init()})},updateServer(){rin.$socket.emit("updateServer",{inputs:rin.inputHandler.inputs,angle:rin.game.currentPlayer.gameObj.angle})}},GunHandler:{createGunShot(e){let t=e.startx+e.length*Math.cos(e.angle/180*Math.PI),i=e.starty+e.length*Math.sin(e.angle/180*Math.PI),s=(new rin.LineDrawer).graphics;s.moveTo(e.startx,e.starty),s.lineTo(t,i)},useRequest(){let e=rin.game.ins.input.mousePointer.x+rin.game.ins.camera.x,t=rin.game.ins.input.mousePointer.y+rin.game.ins.camera.y;rin.$socket.emit("useRequest",[e,t])}},popups:{open:function(e){$("._overlay").addClass("_show"),$("body").addClass("ow-hidden"),$(e).addClass("_show"),setTimeout(()=>{$(document).on("click",t=>{$(t.target).closest(e).length||this.close(e)})},10)},close:function(e){$(e).removeClass("_show"),$("._overlay").removeClass("_show"),$("body").removeClass("ow-hidden"),$(e).prop("classList").contains("_no-click-outside")||$(document).off("click")}}};